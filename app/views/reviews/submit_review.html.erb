<p style="color: green"><%= notice %></p>

<div class="container d-flex justify-content-between">
  <div><%= image_tag "logo.png", alt: "Logo", class: "logo-style" %></div>
  <b style="align-self: center; margin-left: 35px">CUSTOMER EXPERIENCE SURVEY</b>
</div>

<div class="container">
  <%= form_with(model: @review) do |form| %>
    <%= form.hidden_field :order_id, value: params[:order_id] %>

    <div id="r1">
      <div class="d-flex align-items-center justify-content-center">
        <%= form.label :rating1, "Please rate your overall satisfaction with your experience of this Krizels Order" %>
      </div>
      <div class="d-flex align-items-center justify-content-center">
        <div><%= image_tag "sad.png", alt: "Sad", class: "emoji-style" %></div>
        <div class="rating d-flex flex-row-reverse">
          <%= form.radio_button :rating1, 5, id: "r1_star1", class: "star-radio" %>
          <label for="r1_star1">★</label>
          <%= form.radio_button :rating1, 4, id: "r1_star2", class: "star-radio" %>
          <label for="r1_star2">★</label>
          <%= form.radio_button :rating1, 3, id: "r1_star3", class: "star-radio" %>
          <label for="r1_star3">★</label>
          <%= form.radio_button :rating1, 2, id: "r1_star4", class: "star-radio" %>
          <label for="r1_star4">★</label>
          <%= form.radio_button :rating1, 1, id: "r1_star5", class: "star-radio" %>
          <label for="r1_star5">★</label>
        </div>
        <div><%= image_tag "happy.png", alt: "Happy", class: "emoji-style" %></div>
      </div>
    </div>
  
    <div id="r2" class="d-none">
      <hr>
      <div class="d-flex align-items-center justify-content-center">
        <h6>Please rate your satisfaction with... </h6>
      </div>
      <br>
      <div class="d-flex align-items-center justify-content-center">
        <%= form.label :rating2, "The taste of your food." %>
      </div>
      <div class="d-flex align-items-center justify-content-center">
        <div><%= image_tag "sad.png", alt: "Sad", class: "emoji-style" %></div>
        <div class="rating d-flex flex-row-reverse">
          <%= form.radio_button :rating2, 5, id: "r2_star1", class: "star-radio" %>
          <label for="r2_star1">★</label>
          <%= form.radio_button :rating2, 4, id: "r2_star2", class: "star-radio" %>
          <label for="r2_star2">★</label>
          <%= form.radio_button :rating2, 3, id: "r2_star3", class: "star-radio" %>
          <label for="r2_star3">★</label>
          <%= form.radio_button :rating2, 2, id: "r2_star4", class: "star-radio" %>
          <label for="r2_star4">★</label>
          <%= form.radio_button :rating2, 1, id: "r2_star5", class: "star-radio" %>
          <label for="r2_star5">★</label>
        </div>
        <div><%= image_tag "happy.png", alt: "Happy", class: "emoji-style" %></div>
      </div>
    </div>

    <div id="r3" class="d-none">
      <hr>
      <div class="d-flex align-items-center justify-content-center">
        <%= form.label :rating3, "Fries were frozen properly at delivery." %>
      </div>
      <div class="d-flex align-items-center justify-content-center">
        <div><%= image_tag "sad.png", alt: "Sad", class: "emoji-style" %></div>
        <div class="rating d-flex flex-row-reverse">
          <%= form.radio_button :rating3, 5, id: "r3_star1", class: "star-radio" %>
          <label for="r3_star1">★</label>
          <%= form.radio_button :rating3, 4, id: "r3_star2", class: "star-radio" %>
          <label for="r3_star2">★</label>
          <%= form.radio_button :rating3, 3, id: "r3_star3", class: "star-radio" %>
          <label for="r3_star3">★</label>
          <%= form.radio_button :rating3, 2, id: "r3_star4", class: "star-radio" %>
          <label for="r3_star4">★</label>
          <%= form.radio_button :rating3, 1, id: "r3_star5", class: "star-radio" %>
          <label for="r3_star5">★</label>
        </div>
        <div><%= image_tag "happy.png", alt: "Happy", class: "emoji-style" %></div>
      </div>
    </div>

    <div id="r4" class="d-none">
      <hr>
      <div class="d-flex align-items-center justify-content-center">
        <%= form.label :rating4, "Delivery time of order." %>
      </div>
      <div class="d-flex align-items-center justify-content-center">
        <div><%= image_tag "sad.png", alt: "Sad", class: "emoji-style" %></div>
        <div class="rating d-flex flex-row-reverse">
          <%= form.radio_button :rating4, 5, id: "r4_star1", class: "star-radio" %>
          <label for="r4_star1">★</label>
          <%= form.radio_button :rating4, 4, id: "r4_star2", class: "star-radio" %>
          <label for="r4_star2">★</label>
          <%= form.radio_button :rating4, 3, id: "r4_star3", class: "star-radio" %>
          <label for="r4_star3">★</label>
          <%= form.radio_button :rating4, 2, id: "r4_star4", class: "star-radio" %>
          <label for="r4_star4">★</label>
          <%= form.radio_button :rating4, 1, id: "r4_star5", class: "star-radio" %>
          <label for="r4_star5">★</label>
        </div>
        <div><%= image_tag "happy.png", alt: "Happy", class: "emoji-style" %></div>
      </div>
    </div>

    <div id="r5", class="d-none">
      <hr>
      <div class="d-flex align-items-center justify-content-center">
        <%= form.label :comments, "Additional Comments" %>
      </div>

      <div class="d-flex align-items-center justify-content-center">
        <%= form.text_area :comments, id: "comments", maxlength: 1200, cols: 80, rows: 8, placeholder: "We constantly try for excellence in serving you. Is there anything we can improve to ensure your next order surpasses your expectations?" %>
      </div>

      <div class="d-flex align-items-center justify-content-center">
        <small id="text-counter" class="form-text text-muted"> Remaining / Allowed: <b>1200 / 1200</b></small>
      </div>

      <%= form.submit "Submit Review", class: "mt-4" %>
    </div>
  <% end %>
</div>

<script type="module">
  document.addEventListener("DOMContentLoaded", function() {
    function showNextRating(currentRating) {
      var nextRatingId = "r" + (parseInt(currentRating.substring(1)) + 1);
      var nextRatingSection = document.getElementById(nextRatingId);
      if (nextRatingSection) {
        nextRatingSection.classList.remove("d-none");
      }
    }

    document.querySelectorAll(".star-radio").forEach(function(radio) {
      radio.addEventListener("change", function() {
        var currentRating = this.id;
        showNextRating(currentRating);
      });
    });

    function updateCharacterCounter() {
      var textArea = document.getElementById("comments");
      var counter = document.getElementById("text-counter");
      var remaining = textArea.maxLength - textArea.value.length;
      counter.textContent = "Remaining / Allowed: " + `${remaining} / 1200`;
    }

    // Add event listener to textarea for input event
    var textArea = document.getElementById("comments");
    textArea.addEventListener("input", updateCharacterCounter);

    // Initial update of character counter
    updateCharacterCounter();
  });
</script>
